<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dassa.mapper.DriverMapper">
		<!--mypage뿌리기  -->
		<select id="driverMyPage" parameterType="userVO" resultType="userVO">
		   select user_idx as userIdx,
				user_id as userId,
				user_pw as userPw,
				user_name as userName,
				user_phone as userPhone,
				user_email as userEmail,
				user_introduce as userIntroduce,
				registration_number as registrationNumber,
				user_car as userCar,
				comp_filename as compFilename,
				comp_filepath as compFilepath,
				user_type as userType,
				social_id as socialId 
		  from user_tbl where user_id=#{userId} 
		</select>
		
	<!--mypage 이미지만 업로드  -->	
	<update id="driverMypageUpdate" parameterType="userVO">
	update user_tbl set
	comp_filename=#{compFilename}, comp_filepath=#{compFilePath}
		where user_id=#{userId}
	</update>
	
	
	<!--mypage 텍스트 업로드  -->
	<update id="driverMypageUpdateText" parameterType="userVO">
	update user_tbl set 
	user_name=#{userName},
	user_phone=#{userPhone},
	user_email=#{userEmail},
	user_introduce=#{userIntroduce},
	user_car=#{userCar}
		where user_id=#{userId}
	</update>
	
	<!--입찰 검색 //입찰목록 뿌리기-->
	<select id="driverAuctionList" resultType="moveApplyVO" parameterType="com.dassa.vo.DriverPageData">
		select a.* from (
			select guest_idx as guestIdx,
				guest_name as guestName,
				start_addr1 as startAddr1,
				start_addr2 as startAddr2,
				start_addr3 as startAddr3,
				start_latitude as startLatitude,
				start_longitude as startLongitude,
				end_addr1 as endAddr1,
				end_addr2 as endAddr2,
				end_addr3 as endAddr3,
				end_latitude as endLatitude,
				start_longitude as endLongitude,
				apply_date as applyDate,
				apply_time as applyTime,
				ROW_NUMBER() OVER(ORDER BY guest_Idx DESC) rNUM
				from move_apply_tbl
				where apply_status =0  
				
				<if test="userName!=''" >
				and guest_name like '%'||#{userName}||'%'			
				</if>
				<if test="minDate!='' and maxDate!=''">
					and apply_date between to_date(replace('${minDate}','-','')||'000000', 'YYYYMMDDhh24miss') 
              		and to_date(replace('${maxDate}','-','')||'235959','YYYYMMDDhh24miss')
				</if>
				) a
			where rNUM between (${page}-1)*${listSize}+1 and ${page}*${listSize}
	</select>
	
	<!--총 게시물 수 구하기(입찰 페이징)  -->
	<select id="driverTotalCount" resultType="_int" parameterType="com.dassa.vo.DriverPageData">
		select count(*) cnt from
		(
			select 
				ROW_NUMBER() OVER(ORDER BY guest_Idx DESC) rNUM
				from move_apply_tbl
				where apply_status =0  
				
				<if test="userName!=''" >
				and guest_name like '%'||#{userName}||'%'			
				</if>
				<if test="minDate!='' and maxDate!=''">
					and apply_date between to_date(replace(#{minDate},'-','')||'000000', 'YYYYMMDDhh24miss') 
              		and to_date(replace(#{maxDate},'-','')||'235959','YYYYMMDDhh24miss')
				</if>
		)
	</select>
	
	
	
	
	
	<!--이사목록 뿌리기  -->
	<select id="driverMoveList" resultType="moveApplyVO" parameterType="com.dassa.vo.DriverPageData">
			 select a.* from (
			select guest_idx as guestIdx,
				apply_date as applyDate,
				apply_time as applyTime,
				guest_name as guestName,
				guest_phone as guestPhone,
				start_addr1 as startAddr1,
				end_addr1 as endAddr1,
				apply_hope as applyHope,
				apply_status as applyStatus,
				ROW_NUMBER() OVER(ORDER BY guest_Idx DESC) rNUM
				from move_apply_tbl
				where (apply_status =1 or apply_status =2)
				
				<if test="userName!=''" >
				and guest_name like '%'||#{userName}||'%'			
				</if>
				<if test="minDate!='' and maxDate!=''">
					and apply_date between to_date(replace(#{minDate},'-','')||'000000', 'YYYYMMDDhh24miss') 
              		and to_date(replace(#{maxDate},'-','')||'235959','YYYYMMDDhh24miss')
				</if>
				) a
			where rNUM between (#{page}-1)*#{listSize}+1 and #{page}*#{listSize}
	</select>
	
	<select id="driverMoveTotalCount" resultType="_int" parameterType="com.dassa.vo.DriverPageData">
			select count(*) cnt from
			(
			select 
				ROW_NUMBER() OVER(ORDER BY guest_Idx DESC) rNUM
				from move_apply_tbl
				where (apply_status =1 or apply_status = 2) 
				
				<if test="userName!=''" >
				and guest_name like '%'||#{userName}||'%'			
				</if>
				<if test="minDate!='' and maxDate!=''">
					and apply_date between to_date(replace(#{minDate},'-','')||'000000', 'YYYYMMDDhh24miss') 
              		and to_date(replace(#{maxDate},'-','')||'235959','YYYYMMDDhh24miss')
				</if>
		)
	</select>
	
</mapper>